# rdb
- 数据快照
- 优：数据恢复快，RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快
    - RDB文件紧凑，全量备份，非常适合用于进行备份和灾难恢复。
    - 生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。
- 缺点：容易丢数据
    - 当进行快照持久化时，会开启一个子进程专门负责快照持久化，
    子进程会拥有父进程的内存数据，父进程修改内存子进程不会反应出来，
    **所以在快照持久化期间修改的数据不会被保存，可能丢失数据。**

- 触发持久化的方式
    - bgsave触发方式：执行该命令时，Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求。
    - save触发方式：该命令会阻塞当前Redis服务器，执行save命令期间，Redis不能处理其他命令，直到RDB过程完成为止

``` 配置
配置文件触发持久化
save：这里是用来配置触发 Redis的 RDB 持久化条件，也就是什么时候将内存中的数据保存到硬盘。
比如“save m n”。表示m秒内数据集存在n次修改时，自动触发bgsave。

rdbcompression ；默认值是yes。对于存储到磁盘中的快照，可以设置是否进行压缩存储。
dbfilename ：设置快照的文件名，默认是 dump.rdb
dir：设置快照文件的存放路径，这个配置项一定是个目录，而不能是文件名。
```

# aof
- redis会将每一个收到的写命令都通过write函数追加到文件中。通俗的理解就是日志记录。
- AOF也有三种触发机制
    - （1）每修改同步always：同步持久化 每次发生数据变更会被立即记录到磁盘 性能较差但数据完整性比较好
    - （2）每秒同步everysec：异步操作，每秒记录 如果一秒内宕机，有数据丢失
    - （3）不同no：从不同步
- 优点：
    - AOF可以更好的保护数据不丢失，一般AOF会每隔1秒，通过一个后台线程执行一次fsync操作，最多丢失1秒钟的数据。
    - AOF日志文件即使过大的时候，出现后台重写操作，也不会影响客户端的读写。
    - AOF日志文件的命令通过非常可读的方式进行记录，这个特性非常适合做灾难性的误删除的紧急恢复。
    比如某人不小心用flushall命令清空了所有数据，只要这个时候后台rewrite还没有发生，
    那么就可以立即拷贝AOF文件，将最后一条flushall命令给删了，然后再将该AOF文件放回去，
    就可以通过恢复机制，自动恢复所有数据
- 缺点
    - 对于同一份数据来说，AOF日志文件通常比RDB数据快照文件更大
    - 
    - 以前AOF发生过bug，就是通过AOF记录的日志，进行数据恢复的时候，没有恢复一模一样的数据出来。 
    
```配置
Redis Bgrewriteaof 命令用于异步执行一个 AOF（AppendOnly File） 文件重写操作。

appendonly no  是否开启aof

# appendfsync always
appendfsync everysec
# appendfsync no

aof存储的文件目录
appenddirname "appendonlydir"

```