# 抢红包
https://www.cnblogs.com/jiawen010/articles/11506391.html
## 步骤
- 1 发红包，同步到群聊中，消息广播可能会有延迟，根据网络来确定
- 2 点击抢红包,两种情况
    - 1 展示抢的界面，这里也分两种情况
        - 可以抢到
        - 展示红包已经抢完的界面（手慢了）
    - 2 展示红包已经抢完的界面
    
    
- 3 抢到红包之后的同步金额，将钱发到微信账户
- 4 展示红包领取详情
- 5 如果红包没有领取完，将在24小时后失效并且将红包剩余金额退回到用户账户中。

# 设计方案
- 抢红包设计方案：全部在Redis缓存中操作，每一个红包都会有一个唯一的key，发红包时会进行缓存，并且设置红包过期时间。
抢完之后CAS异步更新数据库（可以使用消息队列），在最后异步发送金额到抢到的用户的账户中。
    - 红包个数：抢成功之后原子-1
        - key：hb_群名_用户id_个数_随机唯一id，
        - value：红包个数
        - 通过String 命令decr原子减，每次减1 ，
    - 红包金额：抢成功之后原子-抢到的红包金额
        - key：hb_群名_用户id_金额_随机唯一id，
        - value：红包金额
      

- 在Redis数据过期之后，我们要想办法过期数据库中的红包数据。
    - 可以使用监控Redis的key的过期，然后在更新数据库的信息
    -  notify-keyspace-events Ex 将redis配置打开

- 注意抢红包要注意，每个人都要抢得到。
- 可以使用布隆过滤器 获取红包的时候判断红包是否存在，可以减少缓存或者数据库的请求。