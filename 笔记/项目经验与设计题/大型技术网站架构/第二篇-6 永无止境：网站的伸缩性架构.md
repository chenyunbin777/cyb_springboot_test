# 6 永无止境：网站的伸缩性架构

## 6.1 伸缩性设计


## 6.2 应用服务器集群的伸缩性设计
- 1 http充电箱负载均衡

- 2 DNS域名解析负载均衡：通过DNS处理请求 每次都会根据负载均衡算法算出一个不同的ip地址返回。

- 3 反向代理负载均衡：反向代理服务进行请求转发到对应的服务集群中的某一台服务器上。

- 4 ip负载均衡：与反向代理不同的是，进行了ip的修修改
    - 在网络层通过修改请求目标地址进行负载均衡。
    - 客户端网络请求=》负载均衡服务器（网关层），通过计算，将请求的ip地址修改为10.0.0.1=>服务器10.0.0.1，处理完成在根据链路返回给客户端
    - 缺点：所有的请求和响应都会经过网关层，大响应的吞吐量不得不受限于负载均衡服务器的**网卡 带宽**，
    可不可以在负载均衡服务器指进行内容分发请求，而使响应直接返回给用户呢？ 当然是可以的了。
    
- 5 数据链路层负载均衡：
    - 数据链路层负载均衡是指在通信协议的**数据链路层修改mac地址**进行负载均衡
    - 负载均衡服务器与真实的物理服务器集群所有机器的虚拟ip都是一致的，从而达到不修改数据包的原地址

- 6 负载均衡算法：
    - 轮询
    - 加权轮询：根据服务器的性能设置权重，性能高的可以接受到更多的七扭去
    - 随机
    - 最少连接：分发请求到连接最少的服务上
    - 原地址散列

## 6.3 分布式缓存集群的伸缩性设计
- 一致性hash算法
    - 2^32长度的整数环，范围[0,2^32]，根据服务器节点名称的hash值放到对应hash环的位置上，需要缓存的key计算hash（相同的hash计算函数）
    放到具体的环上的某一位置，根据顺时针的方向找到对应的服务器节点。
    - 负载不均匀的问题：服务器节点在hash环上的分布可能是不均匀的，我们可以设置 **"服务器的虚拟节点"**，使得服务器在hash环上分布均匀。
        - 但是虚拟节点的数量如何控制呢，太少负载不均匀，太多的话影响性能？ 一般经验值是**150个**
        

## 6.4 数据存储服务器集群的伸缩性设计

- 关系数据库 

- NOSQL数据库