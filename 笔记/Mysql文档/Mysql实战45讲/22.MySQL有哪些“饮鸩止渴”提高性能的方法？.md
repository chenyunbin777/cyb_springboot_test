# 22.MySQL有哪些“饮鸩止渴”提高性能的方法？
```
show processlist 用于查看当前数据库连接的所有进程的命令。会返回一个结果集，包含所有当前连接的进程的相关信息，比如线程ID、用户、主机、数据库、命令、时间等。

```

## 第一种方法：先处理掉那些占着连接但是不工作的线程。
- 从服务端断开连接使用的是kill connection + id的命令， 一个客户端处于sleep状态时，它的连接 被服务端主动断开后，这个客户端并不会马上知道。
直到客户端在发起下一个请求的时候，才会 收到这样的报错“ERROR 2013 (HY000): Lost connection to MySQL server during query”。
- 从数据库端主动断开连接可能是有损的，尤其是有的应用端收到这个错误后，不重新连接，而是直接用这个已经不能用的句柄重试查询。这会导致从应用端看上去，“MySQL一直没恢复”。
- 所以，如果你是一个支持业务的DBA，不要假设所有的应用代码都会被正确地处理。即使只是 一个断开连接的操作，也要确保**通知到业务开发团队**。

## 第二种方法：减少连接过程的消耗。
- 有的业务代码会在短时间内先大量申请数据库连接做备用，如果现在数据库确认是被连接行为打 挂了，那么一种可能的做法，是**让数据库跳过权限验证**阶段。
- 这种方式风险很高，不推荐

## 慢查询性能问题
在MySQL中，会引发性能问题的慢查询，大体有以下三种可能： 
1. 索引没有设计好； 
2. SQL语句没写好； 
3. MySQL选错了索引。

- 
1. 上线前，在测试环境，把慢查询日志（slow log）打开，并且把long_query_time设置成0， 确保每个语句都会被记录入慢查询日志； 
2. 在测试表里插入模拟线上的数据，做一遍回归测试； 
3. 观察慢查询日志里每类语句的输出，特别留意Rows_examined字段是否与预期一致。（我 们在前面文章中已经多次用到过Rows_examined方法了，相信你已经动手尝试过了。如果 还有不明白的，欢迎给我留言，我们一起讨论）。
   - 你会在数据库的慢查询日志中看到一个 rows_examined 的字段，表示这个语句执行过程中扫描了多少行。这个值就是在执行器每次调用引擎获取数据行的时候累加的，但是引擎扫描行数跟 rows_examined 并不是完全相同的。


## QPS突增问题
- 有时候由于业务突然出现高峰，或者应用程序bug，导致某个语句的QPS突然暴涨，也可能导致 MySQL压力过大，影响服务。
