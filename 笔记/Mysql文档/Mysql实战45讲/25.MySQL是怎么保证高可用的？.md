# 25.MySQL是怎么保证高可用的？


# 主备延迟
- 主备延迟最直接的表现是，备库消费中转日志（relay log）的速度，比主库生产binlog 的速度要慢。接下来，我就和你一起分析下，这可能是由哪些原因导致的。
- seconds_behind_master参数：主备延迟的时间，单位 s

## 主备延迟的来源
1. 首先，有些部署条件下，备库所在机器的性能要比主库所在的机器性能差。
2. 第二种常见的可能了，即备库的压力大
   - 一主多从
   - bin log同步到其他系统来用于查询，如大数据Hadoop，或者ES Mysql数据同步
3. 第三种可能：大事务，因为主库上必须等事务执行完成才会写入binlog，再传给备库。所以，如果一个主库上的语句执行10分钟，那这个事务很可能就会导致从库延迟10分钟。
   - 不要一次性地用 一 delete d 语句删除太多数据 语 。其 实，这就是一个典型的大事务场景
   - 如果主库上也不做大事务了，还有什么原因会导致主备延迟吗？
     - 造成主备延迟还有一个大方向的原因，就是**备库的并行复制能力** 。



- 在满足数据可靠性的前提下，MySQL高可用系统的可用性，是依赖于主 备延迟的。延迟的时间越小，在主库故障的时候，服务恢复需要的时间就越短，可用性就越高。

# 可靠性优先策略
- 在满足数据可靠性的前提下，MySQL高可用系统的可用性，是依赖于主备延迟的。延迟的时间越小，在主库故障的时候，服务恢复需要的时间就越短，可用性就越高。



# 可用性优先策略
- 不等主备数据同步，直接把连接切到备库B，并且让备库B可以读写，那么系统几乎就没有不可用时间了。
- 缺点：产生数据不一致



# 问题
- 一般现在的数据库运维系统都有备库延迟监控，其实就是在备库上执行 showslave status，采集 seconds_behind_master的值。
  假设，现在你看到你维护的一个备库，它的延迟监控的图像类似图6，是一个45°斜向上的线段， 你觉得可能是什么原因导致呢？你又会怎么去确认这个原因呢？
  - 答：备用库压力过大导致，可能是读压力太大。
  - 大事务，因为主库上必须等事务执行完成才会写入binlog，再传给备库。