# 项目背景
- 弹个车品牌升级工厂直销店，平台定位由“车+金融”向“互联网汽车新零售平台”转变
- 主要是我们与车企进行合作，比如吉利，他们和提供给我们一些优质的车辆资源，并且专供给我们直销店铺使用
- 口号：品牌直供，好车不贵
- 主要有以下变化：
    - 1 在渠道管理上，挑选优质合作伙伴，成立新的“大搜车工厂直销店”一级经销商店用以开展新业务 
    - 2、在品牌宣传上，在弹个车持续运营的基础上启用全新品牌，原弹个车店铺仍维系原品牌；
    - 3、在用户体系上，toC 新增“工厂直销店”app，新app启用新的会员系统，与原弹个车客户进行隔离
    - 4、在业务开展上，仍然沿用现有弹个车的产品和业务，融租产品将接入我们团队自有的交易系统（全款、消费贷）
    
## 难点
- 主要参与负责了大搜车工厂直销店商家端的系统架构的设计与代码编写，我们对于原来弹个车业务的架构进行了重构与升级，
将模块重新进行了划分整理，生成了一个全新的微服务生态体系



- 1. 系统架构:我们进行详细的模块的划分，每个模块相互独立，进行解耦操作

    - 基础核心服务：处理客户，线索等基础数据，将提供的服务通过dubbo接口的形式提供给外部使用
    - 接口服务：与前端交互的所有接口，MQ消息的接收与处理。
    - 基础服务层：首页，登录，权限，消息中心，用户中心等基础服务。
    - 客户轨迹采集服务：因为我们每天产生的客户轨迹数量很大，所以我们将其拆分出来独立称为一个服务。
    - 销售任务服务：处理销售的日常回访任务
    
- 2. 数据迁移策略()
    - 背景：一期的工厂直销店是在老的弹个车APP的层面兼容的，在二期的时候我们是创建了一个新的工厂直销店APP，
    需要将所有的直销客户客户数据、线索数据、轨迹数据、任务数据迁移到我们的新的数据表中。
    - 难点：
        - 一期的是弹个车和直销所有的数据都在弹个车的数据表中。
        - 1 那我们如何能保证我们的直销数据可以完整的迁移到我们的新的库表当中呢？
        又是如何保证数据的完整的呢？
        - 2 还有店铺是实时在变化的，我们怎么保证所有的直销店铺的数据都可以迁移到我们的新表中呢？
        - 如何保证数据的完整性：
        • 未上线前进行的全量数据迁移：我们将工厂店的客户，线索等数据导出到中间表mid中；再通过脚本将数据导入到对应的工厂店数据表中，并且记录数据是否迁移成功，记录到新旧数据关联表link中（失败的找出原因再处理）；我们再对迁移数据总量进行核对；最后清空mid表，为下一次迁移做准备。
        • 未上线前的进行增量数据迁移：根据全量迁移的结束时间，将数据导入到中间表mid中；将link表中迁移过的数据进行更新，保证数据的完整性；将没有迁移过的数据还是将成功或失败的状态记录在link中；对数据总量进行核对，最后清空mid表。
        • 最后工厂店app强更之后，进行最后一次数据增量迁移：大部分数据正常迁移完成，对于个别数据的异常我们进行了针对性的修复工作，最终保证了数据的完整性。

    - 自身在其中的价值：我经历这期间的所有操作，
        - 熟知了我们迁移动作的一个关键流程，
        - 也知道了异常数据的处理方式
        - 如果在经历相同的事情的话，我相信会做的游刃有余。    

- 3 模块接口改造
    - 我们依赖的店铺，用户中心，登录sso 服务都需要进行特定的改造。



一 大搜车工厂直销店商家端 
1 目的：弹个车品牌升级工厂直销店，平台定位由“车+金融”向“互联网汽车新零售平台转变”
2 如何做：店铺新增“工厂直销店属性”，对不同业务属性进行数据隔离，对整个弹个车架构重新设计与升级，对外部依赖的消息监听与查询服务进行调整。
3 业务与技术挑战：
弹个车业务繁琐，代码冗余高，耦合性高，代码重构复杂
外部依赖众多，业务设计时需要考虑与外部依赖的服务之间的协调性
上线时间紧急，依赖了弹个车的数据，需要保证直销店铺数据的一致性

4 技术解决方式：
基于良好的设计模式解决代码冗余
    - 装饰器模式：如果在这个功能
    - Spring AOP：

模块之间解耦分离，提供外部查询API
使用适合的中间件的方式解决外部依赖的协调，开发文档的规范处理调用不明确的问题
定义数据迁移规则与数据迁移方式来保证数据的一致性		
            